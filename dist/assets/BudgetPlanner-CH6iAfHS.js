import{c as G,r as l,u as L,j as e,m as w,l as J,P as W,n as k,g as K,o as Q,f as X,s as Y}from"./index-BQP0fyHA.js";import{C as Z,f as _,g as B,P as ee,h as se,i as te}from"./storage-CypTBWy_.js";import{B as C}from"./button-GPVt3lpZ.js";import{D as R,a as q,f as ae,g as re,b as ne,c as ie,d as oe}from"./dialog-BtKVVTZx.js";import{T as le,a as ce,b as z,c as H}from"./tabs-ImSbNTYp.js";import{P as de,p as ue}from"./progress-BanBI7yj.js";import{f as O,a as me}from"./categories-DStd93aM.js";import{C as he}from"./CategoryIcon-9rblxCWz.js";import{M as E}from"./MoneyAmount-CWBpIcKK.js";import{A as xe,a as ge,T as pe,b as je,c as ye,d as ve,e as fe,f as be,g as Ce,h as Ne}from"./alert-dialog-BUa5Yd-y.js";import{I as U}from"./input-DQzwsVZq.js";import{L as F}from"./label-BtERDAu_.js";import{v as Ae}from"./v4-CmTdKEVZ.js";import"./Logo-K4bnVDL9.js";import"./index-CWH1sb8B.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=G("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),$=l.memo(function({budgets:g,getBudgetProgress:u,onEdit:f,onDelete:y}){const[p,m]=l.useState({}),{activeCurrency:j}=L();return l.useEffect(()=>{let t=!0;return(async()=>{const r={};for(const o of g){if(!t)return;r[o.id]={loading:!0},m(i=>({...i,[o.id]:{...i[o.id],loading:!0}}));try{const i=await u(o);if(!t)return;r[o.id]={...i,loading:!1},m(b=>({...b,[o.id]:{...i,loading:!1}}))}catch(i){if(console.error(`Error getting budget progress for ${o.id}:`,i),!t)return;r[o.id]={spent:0,budgetAmount:o.amount,percentage:0,isOverBudget:!1,loading:!1},m(b=>({...b,[o.id]:{spent:0,budgetAmount:o.amount,percentage:0,isOverBudget:!1,loading:!1}}))}}})(),()=>{t=!1}},[g,u,j]),g.length===0?null:e.jsx("div",{className:"space-y-4",children:g.map((t,h)=>{const r=p[t.id]||{spent:0,budgetAmount:t.amount,percentage:0,isOverBudget:!1,loading:!0};return e.jsx(w.div,{initial:"hidden",animate:"visible",variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{delay:h*.1,duration:.3}}},children:e.jsxs(Z,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{category:t.category,className:"mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:O(t.category)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.period.charAt(0).toUpperCase()+t.period.slice(1)," budget",t.currency&&t.currency!==j&&e.jsxs("span",{children:[" â€¢ Original: ",t.currency]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>f(t),children:e.jsx(De,{className:"h-4 w-4"})}),e.jsxs(xe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(je,{children:[e.jsxs(ye,{children:[e.jsx(ve,{children:"Delete Budget"}),e.jsx(fe,{children:"Are you sure you want to delete this budget? This action cannot be undone."})]}),e.jsxs(be,{children:[e.jsx(Ce,{children:"Cancel"}),e.jsx(Ne,{onClick:()=>y(t.id),className:"bg-destructive text-destructive-foreground",children:"Delete"})]})]})]})]})]}),r.loading?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"animate-pulse bg-muted w-20 h-4 rounded"}),e.jsx("span",{className:"animate-pulse bg-muted w-24 h-4 rounded"})]}),e.jsx("div",{className:"h-2 bg-muted rounded"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{children:[e.jsx(E,{amount:r.spent,originalCurrency:t.currency})," spent"]}),e.jsxs("span",{children:["Budget: ",e.jsx(E,{amount:r.budgetAmount,originalCurrency:t.currency})]})]}),e.jsx(de,{value:r.percentage,className:r.isOverBudget?"bg-red-100":""}),e.jsx("div",{className:"text-xs mt-1 text-right",children:r.isOverBudget?e.jsxs("span",{className:"text-destructive font-medium",children:["Over budget by ",e.jsx(E,{amount:r.spent-r.budgetAmount,originalCurrency:t.currency})]}):e.jsxs("span",{className:"text-muted-foreground",children:[e.jsx(E,{amount:r.budgetAmount-r.spent,originalCurrency:t.currency})," remaining"]})})]})]},t.id)},t.id)})})}),V=({onCreateClick:s})=>e.jsxs(w.div,{className:"text-center py-8 flex flex-col items-center",variants:J,children:[e.jsx("div",{className:"bg-secondary rounded-full p-6 inline-block mb-4",children:e.jsx(W,{className:"h-10 w-10 text-primary"})}),e.jsx("h2",{className:"text-xl font-medium mb-2",children:"No Budgets Yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-xs mx-auto",children:"Create your first budget to start tracking your spending goals"}),e.jsx(R,{children:e.jsx(q,{asChild:!0,children:e.jsx(C,{onClick:s,children:"Create Your First Budget"})})})]}),we=({selectedBudget:s,onSave:g})=>{const[u,f]=l.useState((s==null?void 0:s.category)||"food"),[y,p]=l.useState((s==null?void 0:s.amount.toString())||""),[m,j]=l.useState((s==null?void 0:s.period)||"monthly"),[t,h]=l.useState((s==null?void 0:s.currency)||""),[r,o]=l.useState(!1),{activeCurrency:i,convertAmount:b}=L();l.useEffect(()=>{s?(f(s.category),j(s.period),h(s.currency||i),(async()=>{if(s.currency&&s.currency!==i){o(!0);try{const v=await b(s.amount,s.currency);p(v.toString())}catch(v){console.error("Error converting budget amount:",v),p(s.amount.toString()),k({title:"Conversion error",description:"Could not convert budget amount. Using original value.",variant:"destructive"})}finally{o(!1)}}else p(s.amount.toString())})()):(f("food"),p(""),j("monthly"),h(i))},[s,i]);const S=()=>{if(!u)return;const n=ue(u);n>0?(p(n.toString()),k({title:"AI Suggestion Applied",description:`Based on your spending history, we suggest ${n} for ${O(u)}`})):k({title:"Not enough data",description:"We need more spending history to make a suggestion"})},P=()=>{if(!u||!y||parseFloat(y)<=0){k({title:"Invalid budget",description:"Please enter a valid category and amount",variant:"destructive"});return}const n={id:(s==null?void 0:s.id)||Date.now().toString(),category:u,amount:parseFloat(y),period:m,startDate:(s==null?void 0:s.startDate)||new Date().toISOString(),currency:i};g(n)};return e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"mb-2 block",children:"Category"}),e.jsx("select",{className:"w-full p-2 rounded-md border border-input bg-background",value:u,onChange:n=>f(n.target.value),children:me().map(n=>e.jsx("option",{value:n,children:O(n)},n))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs(F,{htmlFor:"budgetAmount",children:["Amount (",i,")"]}),e.jsx(C,{variant:"outline",size:"sm",onClick:S,type:"button",disabled:r,children:"AI Suggest"})]}),e.jsx("div",{className:"relative",children:r?e.jsx(U,{value:"Converting...",disabled:!0,className:"pl-16"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:i}),e.jsx(U,{id:"budgetAmount",className:"pl-16",type:"number",step:"0.01",placeholder:"0.00",value:y,onChange:n=>p(n.target.value)})]})}),(s==null?void 0:s.currency)&&s.currency!==i&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Original: ",s.amount," ",s.currency]})]}),e.jsxs("div",{children:[e.jsx(F,{className:"mb-2 block",children:"Time Period"}),e.jsxs("select",{className:"w-full p-2 rounded-md border border-input bg-background",value:m,onChange:n=>j(n.target.value),children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"yearly",children:"Yearly"}),e.jsx("option",{value:"daily",children:"Daily"})]})]}),e.jsxs(ae,{children:[e.jsx(re,{asChild:!0,children:e.jsx(C,{variant:"outline",children:"Cancel"})}),e.jsxs(C,{onClick:P,disabled:r,children:[r?"Converting...":s?"Update":"Create"," Budget"]})]})]})},Ve=()=>{const{toast:s}=K(),[g,u]=l.useState([]),[f,y]=l.useState([]),[p,m]=l.useState(!1),[j,t]=l.useState(null),{activeCurrency:h,convertAmount:r}=L(),[o,i]=l.useState("current");l.useEffect(()=>{const a=_(),d=B();u(a),y(d)},[h]);const b=a=>{a.id||(a.id=Ae()),a.currency||(a.currency=h),se(a),u(d=>{const c=d.findIndex(N=>N.id===a.id);if(c>=0){const N=[...d];return N[c]=a,N}else return[...d,a]}),t(null),m(!1),s({title:"Budget saved",description:`Your budget has been ${j?"updated":"created"}`})},S=a=>{te(a),u(d=>d.filter(c=>c.id!==a)),s({title:"Budget deleted",description:"Your budget has been deleted"})},P=a=>{t(a),m(!0)},n=async a=>{const d=new Date;let c;if(a.period==="daily")c=new Date(d),c.setHours(0,0,0,0);else if(a.period==="weekly"){c=new Date(d);const x=c.getDay();c.setDate(c.getDate()-x),c.setHours(0,0,0,0)}else a.period==="monthly"?c=new Date(d.getFullYear(),d.getMonth(),1):c=new Date(d.getFullYear(),0,1);const N=f.filter(x=>{const D=new Date(x.date);return x.category===a.category&&D>=c&&D<=d});let A=0;for(const x of N){const D=x.currency||h;if(D===h)A+=x.amount;else try{const I=await r(x.amount,D);A+=I}catch(I){console.error("Error converting expense amount:",I),A+=x.amount}}let T=a.amount;if(a.currency&&a.currency!==h)try{T=await r(a.amount,a.currency)}catch(x){console.error("Error converting budget amount:",x)}const M=A/T*100;return{spent:A,budgetAmount:T,percentage:Math.min(M,100),isOverBudget:M>100}},v=l.useMemo(()=>({current:g,all:g}),[g]);return e.jsxs("div",{className:"pb-6",children:[e.jsx(ee,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),"Budget Planner"]}),rightContent:e.jsxs(R,{open:p,onOpenChange:m,children:[e.jsx(q,{asChild:!0,children:e.jsx(C,{size:"icon",variant:"ghost",className:"hover:bg-white/10",children:e.jsx(Q,{className:"h-5 w-5"})})}),e.jsxs(ne,{className:"glassmorphism border border-white/20 max-w-md",children:[e.jsx(ie,{children:e.jsx(oe,{children:j?"Edit Budget":"Create New Budget"})}),e.jsx(we,{selectedBudget:j,onSave:b})]})]})}),e.jsx("div",{className:"px-4 pt-2 pb-4",children:e.jsx(w.div,{initial:"hidden",animate:"visible",variants:X,className:"mb-4",children:e.jsxs(le,{defaultValue:"current",value:o,onValueChange:i,className:"w-full",children:[e.jsxs(ce,{className:"grid grid-cols-2 w-full glassmorphism shadow-md border border-white/10 mb-2",children:[e.jsx(z,{value:"current",className:"data-[state=active]:text-primary data-[state=active]:shadow-md",children:"Current Budgets"}),e.jsx(z,{value:"all",className:"data-[state=active]:text-primary data-[state=active]:shadow-md",children:"All Budgets"})]}),e.jsx(H,{value:"current",className:"mt-4",asChild:!0,children:e.jsx(w.div,{initial:"hidden",animate:"visible",exit:"hidden",variants:Y,children:v.current.length>0?e.jsx($,{budgets:v.current,getBudgetProgress:n,onEdit:P,onDelete:S}):e.jsx(V,{onCreateClick:()=>m(!0)})},"current-budgets")}),e.jsx(H,{value:"all",className:"mt-4",asChild:!0,children:e.jsx(w.div,{initial:"hidden",animate:"visible",exit:"hidden",variants:Y,children:v.all.length>0?e.jsx($,{budgets:v.all,getBudgetProgress:n,onEdit:P,onDelete:S}):e.jsx(V,{onCreateClick:()=>m(!0)})},"all-budgets")})]})})})]})};export{Ve as default};
